{"version":3,"sources":["../../controllers/order.js"],"names":["Order","require","Transaction","mongoose","exports","create","req","res","order","_id","Types","ObjectId","summary","body","price","date","Date","user","userData","userId","save","then","status","json","code","message","data","result","catch","console","log","error","confirm","id","params","findOne","exec","confirmed","transaction","deleteOne"],"mappings":";;AAAA,IAAMA,QAAMC,QAAQ,iBAAR,CAAZ;AACA,IAAMC,cAAYD,QAAQ,uBAAR,CAAlB;AACA,IAAME,WAASF,QAAQ,UAAR,CAAf;;AAEAG,QAAQC,MAAR,GAAe,UAACC,GAAD,EAAKC,GAAL,EAAW;;AAEtB;AACA,QAAIC,QAAMR,MAAM;AACZS,aAAI,IAAIN,SAASO,KAAT,CAAeC,QAAnB,EADQ;AAEZC,iBAAQN,IAAIO,IAAJ,CAASD,OAFL;AAGZE,eAAMR,IAAIO,IAAJ,CAASC,KAHH;AAIZC,cAAMC,KAAK,aAAL,CAJM;AAKZC,cAAKX,IAAIY,QAAJ,CAAaC;AALN,KAAN,CAAV;AAOAX,UAAMY,IAAN,GAAaC,IAAb,CAAkB,kBAAQ;AACtBd,YAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQC,SAAQ,4BAAhB,EAA6CC,MAAKC,MAAlD,EAArB;AACH,KAFD,EAGCC,KAHD,CAGO,iBAAO;AACVC,gBAAQC,GAAR,CAAYC,KAAZ;AACAxB,YAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQC,SAAQ,kBAAhB,EAAmCM,OAAMA,KAAzC,EAArB;AACH,KAND;AAOH,CAjBD;;AAmBA;AACA;AACA3B,QAAQ4B,OAAR,GAAgB,UAAC1B,GAAD,EAAKC,GAAL,EAAW;AACvB,QAAI0B,KAAG3B,IAAI4B,MAAJ,CAAWD,EAAlB;AACAjC,UAAMmC,OAAN,CAAc,EAAC1B,KAAIwB,EAAL,EAAd,EAAwBG,IAAxB,GAA+Bf,IAA/B,CAAoC,iBAAO;AACvCb,cAAM6B,SAAN,GAAgB,IAAhB;AACA7B,cAAMY,IAAN,GAAaC,IAAb,CAAkB,YAAI;AAClB,gBAAIiB,cAAYpC,YAAY;AACxBO,qBAAI,IAAIN,SAASO,KAAT,CAAeC,QAAnB,EADoB;AAExBC,yBAAQJ,MAAMI,OAFU;AAGxBE,uBAAMN,MAAMM,KAHY;AAIxBG,sBAAKT,MAAMS,IAJa;AAKxBF,sBAAMC;AALkB,aAAZ,CAAhB;AAOAsB,wBAAYlB,IAAZ,GAAmBC,IAAnB,CAAwB,iBAAO;AAC3BrB,sBAAMuC,SAAN,CAAgB,EAAC9B,KAAID,MAAMyB,EAAX,EAAhB,EAAgCZ,IAAhC,CAAqC,gBAAM;AACvC,2BAAOd,IAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQC,SAAQ,8BAAhB,EAArB,CAAP;AACH,iBAFD,EAGCG,KAHD,CAGO,iBAAO;AACVC,4BAAQC,GAAR,CAAYC,KAAZ;AACA,2BAAOxB,IAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQO,OAAMA,KAAd,EAAoBN,SAAQ,kBAA5B,EAArB,CAAP;AACH,iBAND;AAOH,aARD,EASCG,KATD,CASO,iBAAO;AACVC,wBAAQC,GAAR,CAAYC,KAAZ;AACA,uBAAOxB,IAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQO,OAAMA,KAAd,EAAoBN,SAAQ,mBAA5B,EAArB,CAAP;AACH,aAZD;AAaH,SArBD;AAsBH,KAxBD,EAyBCG,KAzBD,CAyBO,iBAAO;AACVC,gBAAQC,GAAR,CAAYC,KAAZ;AACA,eAAOxB,IAAIe,MAAJ,CAAW,GAAX,EAAgBC,IAAhB,CAAqB,EAACC,MAAK,CAAN,EAAQO,OAAMA,KAAd,EAAoBN,SAAQ,mBAA5B,EAArB,CAAP;AACH,KA5BD;AA6BH,CA/BD","file":"order.js","sourcesContent":["const Order=require('../models/Order')\r\nconst Transaction=require('../models/Transaction')\r\nconst mongoose=require('mongoose')\r\n \r\nexports.create=(req,res)=>{\r\n\r\n    //an order will not be created until the user has made payment\r\n    var order=Order({\r\n        _id:new mongoose.Types.ObjectId(),\r\n        summary:req.body.summary,\r\n        price:req.body.price,\r\n        date: Date('m/d/Y h:i:s'),\r\n        user:req.userData.userId\r\n    })\r\n    order.save().then(result=>{\r\n        res.status(200).json({code:1,message:\"Your order has been placed\",data:result})\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n    })\r\n}\r\n\r\n//confirms an order and creates a transaction\r\n//only admin has permission\r\nexports.confirm=(req,res)=>{\r\n    var id=req.params.id\r\n    Order.findOne({_id:id}).exec().then(order=>{\r\n        order.confirmed=true\r\n        order.save().then(()=>{\r\n            var transaction=Transaction({\r\n                _id:new mongoose.Types.ObjectId(),\r\n                summary:order.summary,\r\n                price:order.price,\r\n                user:order.user,\r\n                date: Date()\r\n            })\r\n            transaction.save().then(trans=>{\r\n                Order.deleteOne({_id:order.id}).then(reds=>{\r\n                    return res.status(200).json({code:1,message:\"The order has been confirmed\"})\r\n                })\r\n                .catch(error=>{\r\n                    console.log(error)\r\n                    return res.status(500).json({code:0,error:error,message:\"An error occured\"})\r\n                })\r\n            })\r\n            .catch(error=>{\r\n                console.log(error)\r\n                return res.status(500).json({code:0,error:error,message:\"An error occurred\"})\r\n            })\r\n        })\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        return res.status(500).json({code:0,error:error,message:\"An error occurred\"})\r\n    })\r\n}\r\n\r\n\r\n\r\n\r\n"]}