{"version":3,"sources":["../../controllers/menu.js"],"names":["Menu","require","base64Img","mongoose","exports","add","req","res","fname","randName","img","body","_image","err","filepath","status","json","code","message","erro","menu","_id","Types","ObjectId","name","price","image","qty","created_at","Date","save","then","console","log","result","data","catch","error","Math","floor","random","b64toImage","find","exec","update","id","params","$set","take","findOne","current_qty","new_qty","delete","remove"],"mappings":"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","file":"menu.js","sourcesContent":["const Menu=require('../models/Menu')\r\nconst base64Img=require('base64-img')\r\nconst mongoose=require('mongoose')\r\n\r\n\r\nexports.add=(req,res)=>{\r\n    var fname=randName()+\".png\"\r\n    base64Img.img(req.body._image, 'img/menu', fname, function(err, filepath) {\r\n        if(err){\r\n            return res.status(500).json({code:0,message:\"An upload error occured\",erro:err})\r\n        }\r\n        if(filepath){\r\n            var menu=Menu({\r\n                _id: new mongoose.Types.ObjectId(),\r\n                name:req.body.name,\r\n                price:req.body.price,\r\n                image:fname,\r\n                qty:req.body.qty,\r\n                created_at:Date()\r\n            })\r\n            menu.save().then(result=>{\r\n                console.log(result)\r\n                res.status(200).json({code:1,message:\"Menu item created\",data:result})\r\n            })\r\n            .catch(error=>{\r\n                console.log(error)\r\n                res.status(500).json({code:0,error:error})\r\n            }) \r\n        }\r\n        \r\n    })\r\n}\r\n\r\nfunction randName(){\r\n    var name=Math.floor((Math.random() * 10000000) + 99000000000)\r\n    return name\r\n}\r\nfunction b64toImage(data,fname){\r\n    base64Img.img(data, 'menu', fname, function(err, filepath) {\r\n\r\n    })\r\n}\r\n\r\n//this gets all the menu items\r\nexports.menu=(req,res)=>{\r\n    Menu.find()\r\n    .exec()\r\n    .then(result=>{\r\n        res.status(200).json({code:1,data:result})\r\n    })\r\n    .catch(error=>{\r\n        res.status(500).json({error:error})\r\n    })\r\n}\r\n\r\nexports.update=(req,res)=>{\r\n    const id=req.params.id\r\n    Menu.update({_id:id},{$set:{name:req.body.name,price:req.body.price,qty:req.body.qty}})\r\n    .then(result=>{\r\n        res.status(200).json({code:1,message:\"Menu updated\",data:result})\r\n    })\r\n    .catch(error=>{\r\n        res.status(500).json({code:0,error:error})\r\n    })\r\n}\r\n\r\nexports.take=(req,res)=>{\r\n    const id=req.params.id\r\n    Menu.findOne({_id:id}).exec()\r\n    .then(menu=>{\r\n        if(menu){\r\n            if(menu.qty<1){\r\n                return res.status(200).json({code:0,message:\"Sorry no more, its finished\"}) \r\n            }\r\n            let current_qty=menu.qty\r\n            let new_qty=current_qty-req.params.take\r\n            menu.qty=new_qty\r\n            menu.save().then(result=>{\r\n                if(result){\r\n                    return res.status(200).json({code:1})\r\n                }\r\n            })\r\n            .catch(err=>{\r\n                return res.status(500).json({code:0,message:\"An error occured\",error:err})\r\n            })\r\n        }\r\n        else{\r\n            return res.status(200).json({code:0,message:\"There is no menu item like that\"}) \r\n        }\r\n    })\r\n    .catch(err=>{\r\n        return res.status(500).json({code:0,message:\"An error occured\",error:err})\r\n    })\r\n}\r\n\r\nexports.delete=(req,res)=>{\r\n    const id=req.params.id\r\n    Menu.remove({_id:id}).then(result=>{\r\n        res.status(200).json({code:1,message:\"Menu deleted\"})\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        res.status(200).json({code:0,message:\"An error occured\"})  \r\n    })\r\n}"]}