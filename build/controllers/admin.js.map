{"version":3,"sources":["../../controllers/admin.js"],"names":["Admin","require","mongoose","bcrypt","jwt","exports","create","req","res","findOne","email","body","exec","then","admin","hash","password","err","console","log","status","json","code","error","_id","Types","ObjectId","name","save","message","data","catch","login","compare","result","token","sign","adminId","type","process","env","JWT","expiresIn","admins","find","seed","next","length","adm","ADMIN_PASS","ADMIN_NAME","ADMIN_EMAIL"],"mappings":"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","file":"admin.js","sourcesContent":["const Admin=require('../models/Admin')\r\nconst mongoose=require('mongoose')\r\nconst bcrypt=require('bcrypt')\r\nconst jwt=require('jsonwebtoken')\r\n\r\nexports.create=(req,res)=>{\r\n    Admin.findOne({email:req.body.email}).exec().then(admin=>{\r\n        if(admin==null){\r\n            bcrypt.hash(req.body.password,10,(err,hash)=>{\r\n                if(err){\r\n                    console.log(err)\r\n                    return res.status(500).json({code:0,error:err})\r\n                }\r\n                var admin=Admin({\r\n                    _id:new mongoose.Types.ObjectId(),\r\n                    name:req.body.name,\r\n                    email:req.body.email,\r\n                    password:hash\r\n                })\r\n                admin.save().then(admin=>{\r\n                    return res.status(200).json({code:1,message:\"Admin created\",data:admin})\r\n                })\r\n                .catch(error=>{\r\n                    console.log(error)\r\n                    return res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n                })\r\n            })\r\n        }\r\n        else{\r\n            return res.status(200).json({code:0,message:\"This admin already exists\"}) \r\n        }\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        return res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n    })\r\n    \r\n}\r\n\r\nexports.login=(req,res)=>{\r\n    Admin.findOne({email:req.body.email}).exec().then(admin=>{\r\n        if(admin==null){\r\n            return res.status(200).json({code:0,message:\"This admin does not exist\"})\r\n        }\r\n        else{\r\n            bcrypt.compare(req.body.password,admin.password,(err,result)=>{\r\n                if(err){\r\n                    return res.status(500).json({code:0,message:\"An error occurred\"})\r\n                }\r\n                if(result){\r\n                    const token=jwt.sign({email:admin.email,adminId:admin._id,type:\"admin\"},process.env.JWT,{\r\n                        expiresIn:\"24h\"\r\n                    })\r\n                    return res.status(200).json({code:1,message:\"Signin successfull\",token:token}) \r\n                }\r\n                else{\r\n                    return res.status(200).json({code:0,message:\"Authentication failed\"})\r\n                }\r\n            })\r\n        }\r\n    })\r\n    .catch(err=>{\r\n        console.log(err)\r\n        return res.status(500).json({code:0,message:\"An error occurred\"})\r\n    })\r\n    \r\n}\r\n\r\nexports.admins=(req,res)=>{\r\n    Admin.find().exec().then(admins=>{\r\n        return res.status(200).json({code:1,data:admins})\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        return res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n    })\r\n}\r\n\r\n\r\nexports.seed=(req,res,next)=>{\r\n    Admin.find().exec().then(admins=>{\r\n        if(admins.length==0){\r\n            var adm=process.env.admin\r\n            bcrypt.hash(process.env.ADMIN_PASS,10,(err,hash)=>{\r\n                if(err){\r\n                    console.log(err)\r\n                    return res.status(500).json({code:0,error:err})\r\n                }\r\n                var admin=Admin({\r\n                    _id:new mongoose.Types.ObjectId(),\r\n                    name:process.env.ADMIN_NAME,\r\n                    email:process.env.ADMIN_EMAIL,\r\n                    password:hash\r\n                })\r\n                admin.save().then(admin=>{\r\n                    return res.status(200).json({code:1,message:\"Admin created\",data:admin})\r\n                })\r\n                .catch(error=>{\r\n                    console.log(error)\r\n                    return res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n                })\r\n            })  \r\n        }\r\n        else{\r\n            return res.status(200).json({code:0,message:\"Admin already exists\"}) \r\n        }\r\n    })\r\n    .catch(error=>{\r\n        console.log(error)\r\n        return res.status(500).json({code:0,message:\"An error occured\",error:error})\r\n    })\r\n}\r\n"]}